---
title: 动态格式更改
description: 动态格式更改
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: a18f70f8e4965256aa157d57c999841d30691221
ms.sourcegitcommit: 418e6617e2a695c9cb4b37b5b60e264760858acd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/07/2020
ms.locfileid: "96784831"
---
# <a name="dynamic-format-change"></a>动态格式更改


动态格式更改是 Windows 7 和更高版本的 Windows 操作系统中的一项功能，它允许使用格式在音频应用程序和音频适配器之间传输音频数据，以进行动态更改。 动态格式更改适用于高清晰多媒体界面 (HDMI) 设备的音频流的行为。 本主题概述动态格式更改，并说明其工作原理。

以下列表显示使用动态格式更改的情况。

-   **HDMI 设备提供了新的功能。** 当 HDMI 设备流式传输音频或视频数据或两者同时流式传输时，音频和视频传输所使用的 HDMI 带宽总大小是固定的，视频信号在容量分配中给予首选项。 这意味着，如果你有连接到计算机的 HDMI 显示设备，并且更改了显示分辨率，则会影响将音频数据传输到计算机所需的带宽大小。

    例如，假设你的 HDMI 设备最初配置为将数据格式设置为 192 KHz，16位立体声，具有特定显示模式。 更改为其他显示模式时，流式传输音频数据的剩余带宽对于 192 KHz 格式可能不足。 因此，设备驱动程序会通知连接计算机的音频服务显示模式发生的更改，这会导致音频驱动程序和音频服务重新协商音频数据格式。 如果无法在剩余带宽内流式传输当前选定的 192 KHz 格式，则选择新的格式。 有关格式协商过程的详细信息，请参阅 [格式协商](format-negotiation.md)。

    在另一种与 HDMI 相关的动态格式更改方案中，拔出音频设备并插入一个支持 HDMI 的新设备。 HDMI 设备的设备驱动程序会生成一个格式更改事件，并且音频服务使用设备驱动程序重新协商音频数据格式。

-   **某些独立音频设备提供了用户可用于更改音频数据格式的硬件控制。** 在此方案中，用户在环绕声放大器上操作控制旋钮，例如，选择音频数据格式。 如果有计算机连接到独立音频设备，此新选择的数据格式会导致连接的计算机上的音频驱动程序重新协商数据格式，并且可能会对其进行更改。

-   **控制面板中的 "声音" 小程序的第三方 UI 提供了用于启用或禁用系统效果的选项。** 当你开发自己的系统效果 (sAPOs) 的音频处理对象时，还可以在控制面板中为 **声音** 小程序提供自定义 UI。 此自定义 UI 可以将修改添加到 **声音** 小程序的 "**增强**" 或 "**高级**" 选项卡中。 在此方案中，用户在 " **增强** " 选项卡中选择一个复选框，以启用或禁用需要更改音频数据格式 (GFX) 功能的全局系统效果。 用户所做的选择将导致 HDMI 驱动程序生成格式更改事件。 音频服务接收有关此事件的通知，并与音频驱动程序协商，以便为音频数据选择新的格式。

为了支持与 IEC61937 兼容的压缩音频格式（例如 (DTS) 的杜比数字和数字影院声音），Windows 7 和更高版本 Windows 操作系统提供了一组新的子类型 Guid 以供内核流式处理 (KS) 属性和结构使用。 IEC 61937 (IEC) 标准的国际电工委员会适用于传输非线性 [PCM](pcm-stream-data-format.md) 编码位流的数字音频接口。 有关子类型 Guid 的详细信息，请参阅 KSDATAFORMAT \_ 子类型 \_ IEC61937 \_ Xxx guid in Ksmedia。

**注意**  
当音频终结点生成器收到动态格式更改通知，并且设备驱动程序不支持建议的数据格式时，终结点生成器将重新计算新的默认设备数据格式。

并且，在重新设计的音频驱动程序现在支持新格式的情况下，它可以强制终结点生成器选择新格式作为设备的默认格式。 若要强制将新格式转变为设备的默认格式，则音频驱动程序必须使它收到的格式支持查询无法满足旧格式。 失败格式支持查询触发格式更改通知，并且终结点生成器将为设备计算新的默认格式。

 

 

 




