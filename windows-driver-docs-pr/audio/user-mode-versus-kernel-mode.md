---
title: 用户模式与内核模式
description: 用户模式与内核模式
keywords:
- 软件合成程序 WDK 音频
- 自定义 synths WDK 音频
- DirectMusic WDK 音频、用户模式和内核模式
- 用户模式 synths WDK 音频，与内核模式
- 内核模式 synths WDK 音频，与用户模式
- 延迟 WDK 音频，DirectMusic
- 硬件合成 WDK 音频
- 时间戳 WDK 音频
- DirectMusic 内核模式 WDK 音频，与用户模式
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: b39f4d6af7de8bb26afed820a89c15f7e575ebd7
ms.sourcegitcommit: 418e6617e2a695c9cb4b37b5b60e264760858acd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/07/2020
ms.locfileid: "96800467"
---
# <a name="user-mode-versus-kernel-mode"></a>用户模式与内核模式


## <span id="user_mode_versus_kernel_mode"></span><span id="USER_MODE_VERSUS_KERNEL_MODE"></span>


可以编写自定义合成，使其在用户模式或内核模式下运行。 通常，软件 synths 在用户模式下更容易实现，但通常可以在内核模式下实现较低的延迟。 只能在内核模式下支持硬件组件。 但是，在用户模式下开始开发时，即使最终的实现是在内核模式下运行，也有很好的理由。

在用户模式下构建软件合成 (和波形接收器) 简单得多。 用户模式接口易于使用，并且简化了调试。 另一个优点是生成的组件是 Microsoft Windows 可执行文件。 由于此可执行文件是一个 COM 对象，因此安装它只是从命令行使用 regsvr32.exe 进行自注册的情况。  (RegSvr32 系统应用程序会调用 DLL 的 [**DllRegisterServer**](/windows/win32/api/olectl/nf-olectl-dllregisterserver) 函数。 有关详细信息，请参阅 Microsoft Windows SDK 文档。 ) 

如果你只需要用户模式实现，你可以使用应用程序（而不是驱动程序）交付你的产品。 用户可以避免执行复杂的驱动程序安装过程，并且在安装后不需要重新启动。 然后，可以将你的用户模式组件枚举为可用端口之一，具体取决于你是否想让其他应用程序能够使用它。 有关详细信息，请参阅 [注册合成](registering-your-synthesizer.md)器。

内核模式软件实现的优点是较低的延迟。 不过，随着时间戳的消息出现，这种优势并不像它那样好。 旧版 MIDI Api 没有时间戳，因此，当您播放便笺时，这就是它排队等待播放的准确时间。 时间戳使你可以在未来指定的时间对笔记进行排队。 如果使用时间戳，则说明笔记会在正确的时间播放，除非提前警告低于系统中固有的延迟。

仅当声音排队等待很少或没有提前警告时，延迟才会出现问题。 因此，仅当用户模式软件实现不需要的限制或支持硬件加速时，才建议使用内核模式实现。

如果决定执行内核模式实现，最好的方法仍是在用户模式下开始开发。 Microsoft Windows 驱动程序工具包 (WDK) 中提供了 Microsoft 的用户模式合成源代码，因此你无需从头开始编写新的合成者。 可以使用现有代码来了解如何分析可下载声音 (DLS) 下载。 然后，可以添加任何新功能 (例如分析其他区块) 并先在用户模式下调试此逻辑，用作存根访问硬件的例程。  (用作存根例程可能不执行任何操作，也不会在软件中模拟硬件功能。 ) 有关 DL 的详细信息，请参阅 Windows SDK 文档。

当你的实现在用户模式下工作时，你可以将其移到 "内核模式" 并使其运行。 在内核模式下运行软件版本后，下一步就是开始将功能移动到硬件。 用户模式和内核模式软件 synths 在启动和运行硬件合成过程中充当有用的中间步骤。

汇总上述建议：

-   对于仅软件组件，请先在用户模式 (中实现组件，以便使用简单的接口、调试、安装和删除) 来处理设计问题，并在必要时转换为内核模式，因为存在延迟或其他注意事项。

-   对于硬件组件，请首先在用户模式下实现软件版本 (以便使用简单的接口、调试、安装和删除) 来处理设计问题，然后将其转换为内核模式软件版本。 最后，将内核模式组件连接到硬件，一次连接一项功能，直到一切正常运行。

 

