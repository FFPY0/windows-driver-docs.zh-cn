---
title: 启动屏幕组件
description: 固件更新启动屏幕有两个组件： OEM 徽标和更新文本。
ms.date: 10/12/2018
ms.localizationpriority: medium
ms.openlocfilehash: 85b749cebcf6cc792c223209a1693d6b211940b6
ms.sourcegitcommit: 418e6617e2a695c9cb4b37b5b60e264760858acd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/07/2020
ms.locfileid: "96803427"
---
# <a name="boot-screen-components"></a>启动屏幕组件

固件更新启动屏幕有两个组件： OEM 徽标和更新文本。 本主题提供有关如何配置上述每个组件的指导，以及有关如何将这些组件传递到固件更新马蹄形固件的信息。

## <a name="oem-logo"></a>OEM 徽标

固件更新启动屏幕中的 OEM 徽标必须与正常启动过程中显示的徽标相同。 对于固件更新引导屏幕，徽标的大小必须与正常启动过程中显示的大小、位置和质量应相同。

### <a name="oem-logo-file"></a>OEM 徽标文件

在客户看到任何可操作屏幕之前，会在启动屏幕上显示您的 OEM 徽标。 

OEM 徽标不会出现在 OOBE 中的任何屏幕上，在 OOBE 之后，它会显示在 **控制面板** 中的 **性能信息和工具** 下。 它不显示在 **设置** 应用中。

POST（开机自检）和操作系统启动时间都比过去快。 为确保您有合适的品牌时刻，POST 和操作系统启动期间均显示 OEM 徽标。 在此方法中，OEM 徽标便于识别、适于维护，并与快速、可靠的体验相关联。

此外，OEM 徽标还作为品牌元素显示在 **控制面板** 应用的 **性能信息和工具** 下。 它不显示在 **设置** 应用中。

#### <a name="create-the-logo"></a>创建徽标

您添加的徽标会为客户提供对运行 Windows 的新电脑的初次视觉印象，因此徽标的边缘以及内部应该干净、清晰。

启动屏幕的背景始终是黑色的，因此请使用在黑色背景下效果良好的徽标。 徽标还必须具有真正的黑色背景，因此徽标的黑色背景结束位置与屏幕的黑色背景开始位置之间没有显著差异。 不支持透明度。 黑色背景可在初始渲染徽标和启动结束进行淡出时优化系统性能，以便于从 UEFI 图形输出协议 (GOP) 过渡到操作系统本机视频驱动程序。 Windows 的其他区域还使用你的徽标：设置、Push-Button 重置 (.PBR) 、安全启动修正和启动修复工具，所有这些区域都使用黑色背景。 这些体验会使用来自启动图形资源表 (BGRT) 的相同徽标。

#### <a name="position-the-logo-during-post"></a>在 POST 期间定位徽标

固件在 POST 期间绘制 OEM 徽标并将该徽标放在预先确定的位置。 当 Windows 开始启动时，徽标将保留在视频缓冲区中。 台式机可通过读取 EDID（扩展显示器标识数据）来检测面板的本机分辨率。

为使徽标在整个序列中正确显示，POST 需以设备的本机分辨率进行。 这样可以确保徽标具有您期望以及 Windows 需要的大小、形状和位置。

徽标应出现在屏幕上的特定位置，以展示电脑的品牌。 建议放置徽标时，其中心到屏幕顶部边缘的距离为总宽度的 38.2%。 此定位基于黄金比例的视觉美学，也与 Windows 10 的设计比例相符。 在运行 Windows 10 的所有电脑上进行一致定位使得 Windows 能将进度环形放在正确位置，并可以确保徽标能与环形在视觉上实现平衡。

为了进一步支持这种视觉平衡，建议您将徽标大小限制为屏幕高度和宽度的 40%。 这样可以确保屏幕能够正确显示，并且 Windows 能够在启动结束时正确淡出。 建议徽标最大面积的开始位置距离屏幕顶部不超过 18.2%。

这些设计原则同时适用于横向和纵向设备。

#### <a name="add-the-logo-to-the-bgrt"></a>向 BGRT 中添加徽标

除了在 POST 期间正确定位徽标外，还要在启动图形资源表 (BGRT) 中存储徽标。 BGRT 可动态定义新对象，供 Windows 用来描述资源和屏幕位置。 将徽标存储在 EfiBootServicesData 中并通过 BGRT 来公开。 BGRT 界面支持此徽标作为像素格式为 0xRRGGBB 的 24 位位图或像素格式为 0xrrRRGGBB 的 32 位位图，其中“rr”为预留位。 这是 Windows 用来访问徽标的标准界面。

BGRT 中的两个重要域是“Image Offset X”（图像偏移 X）和“Image Offset Y”（图像偏移 Y）。 这是徽标屏幕位置左上角的 (x,y) 值。 设置这些值时，请确保不使用徽标的位置或边界框的左上角，否则 Windows 在“安装”、“启动修复”、“按钮重置”或其他体验中将无法正确定位。

在徽标资源中应尽量减少填充，只使用正确居中所必需的功能。 尽量减少填充的使用可节省固件中的空间，并让 Windows 能够正确缩放基于 BGRT 的徽标。 

> [!NOTE]
> 在 OOBE 中，OEM 徽标不会出现在任何屏幕上。

有关 BGRT 的更多详细信息，请参阅 [高级配置和电源接口的5.2.22 部分 (ACPI) 规范](https://uefi.org/specifications)。

## <a name="update-text"></a>更新文本

固件更新启动屏幕中的更新文本是一个简单的字符串，其设计目的是快速阅读，易于理解。 文本由 Windows 引导程序呈现。 确定固件更新处于挂起状态后，引导程序会确定 Windows 的区域设置，并在屏幕上显示本地化文本。

在调用 UpdateCapsule 期间，加载系统将通过所有固件更新马蹄形。 此外，它还会传入 Microsoft 定义的 *固件更新显示* 胶囊，其中包含文本的位图，并显示在屏幕上的位图位置。 系统固件的 UpdateCapsule 方法必须保存胶囊，以便在屏幕上任何时候将其清除或修改。

![固件更新启动屏幕组件](images/firmwareupdatebootscreencomponents.png)

## <a name="windows-firmware-update-display-capsule"></a>Windows 固件更新显示胶囊

当 Windows 引导程序调入系统固件的 UpdateCapsule 方法时，它会传入所有固件更新马蹄形。 此外，它还会传入 Windows UX 胶囊。 此胶囊包含呈现的、本地化文本的位图（必须在屏幕上显示）。 以下 GUID 用于标识此胶囊： {3b8c8162-188c-46a4-aec9-be43f1d65697}。

不保证 UX 胶囊会出现在马蹄形数组中的顺序。 不要依赖于特定的索引位置来查找 UX 胶囊。 最佳做法包括扫描查找 UX 胶囊的阵列并在处理数组中的剩余固件胶囊之前对其进行处理。

需要特别注意的是，在某些情况下，可能没有 UX 胶囊。 例如，在没有显示适配器的无外设服务器的情况下，将不会出现 UX 胶囊。 在这种情况下，固件 UpdateCapsule 调用可能会忽略 UX 胶囊要求。 但是，如果 UX 胶囊存在，则 UpdateCapsule 必须根据本部分中所述的过程对其进行处理。

下表描述了 UX 胶囊的固件更新显示标头。

| 字段 | 字节长度 | 字节偏移量 | 描述 
|---|---|---|---|
| CapsuleGuid      | 16 | 0 | 固件 \_ 更新 \_ 显示 \_ 胶囊 |
| HeaderSize       | 4  | 16 | sizeof (EFI \_ 胶囊 \_ 头)  |
| Flags            | 4           | 20          | 胶囊 \_ 标志 \_ \_ 跨 \_ 重置保留 |
| CapsuleImageSize | 4           | 24          | 4字节无符号整数，描述固件更新显示胶囊的长度。 大小包括页眉和胶囊形，其中包括显示图像。 |

下表介绍了固件更新显示胶囊负载。

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th>字段</th>
<th>字节长度</th>
<th>字节偏移量</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>版本</td>
<td>1</td>
<td>28</td>
<td>标识要实现的显示封装的修订版本。 此字段将设置为1。</td>
</tr>
<tr class="even">
<td>校验和</td>
<td>1</td>
<td>29</td>
<td>包含用于启用简单验证的校验和。 整个胶囊 (标头和负载) （包括显示图像）的总和必须等于零。 如果总和不等于零，则应忽略胶囊。</td>
</tr>
<tr class="odd">
<td>ImageType</td>
<td>1</td>
<td>30</td>
<td>指定嵌入图像的格式：
<ul>
<li>0：位图</li>
<li>1-255：保留供将来使用。</li>
</ul></td>
</tr>
<tr class="even">
<td>预留</td>
<td>1</td>
<td>31</td>
<td>留待将来使用。 必须为零。</td>
</tr>
<tr class="odd">
<td>“模式”</td>
<td>4</td>
<td>32</td>
<td>指定图形输出协议视频模式，该模式能够显示嵌入的图像。 在调用 UpdateCapsule 之前查询视频模式，并描述启动加载程序显示嵌入图像时本地显示的当前视频模式和视频模式。 呈现图像时，值等于 EFI_GRAPHICS_OUTPUT_PROTOCOL_MODE 结构的模式字段。</td>
</tr>
<tr class="even">
<td>映像偏移量 X</td>
<td>4</td>
<td>36</td>
<td>4字节 (32 位) 无符号，用于描述位图图像的 X 偏移量。  (X、Y) 图像左上角的显示偏移量。 显示的左上角位于偏移量 (0，0) 。</td>
</tr>
<tr class="odd">
<td>图像偏移量 Y</td>
<td>4</td>
<td>40</td>
<td><p>4字节 (32 位) 无符号，用于描述位图图像的 Y 偏移量。  (X、Y) 图像左上角的显示偏移量。 显示的左上角位于偏移量 (0，0) 。</p>
<img src="images/imageoffsetrelativetodisplay.png" alt="Image offset value relative to display" /></td>
</tr>
<tr class="even">
<td>映像</td>
<td>空值</td>
<td>44</td>
<td>一个字节数组，其中包含在固件更新过程中要显示的嵌入位图。 位图可以是具有像素格式0xRRGGBB 的24位位图，也可以是具有像素格式0xrrRRGGBB 的32位位图，其中，"rr" 是保留的。</td>
</tr>
</tbody>
</table>

请注意，与为固件更新有效负载生成的胶囊不同，显示胶囊负载不会填充为页对齐。 显示有效负载紧跟在胶囊标头之后。

固件更新显示胶囊描述了一个图形，该图形必须在固件更新期间呈现。 图形最初由 Windows 呈现并显示，并作为同一 UpdateCapsule 调用的一部分移交给固件，其中包含 () 到固件的更新负载。 如果固件重置系统或视频设备，固件必须重新显示显示胶囊中提供的位图。 如果在重置时不保留物理内存，则固件可能需要将位图保存到永久性存储，以便在重置后重新显示位图。 有关如何在重置中保存和还原位图的详细信息是特定于实现的，并且不在本文中讨论。

固件更新显示胶囊 (在 ACPI 5.0 中定义的启动图形资源表中的) 建模。 BGRT 定义了一种机制，用于系统固件为 OS 启动加载程序提供图形。 虽然这两个表是相似的，但有几个值得注意的差异。

| BGRT | 固件更新显示胶囊 | 原因 |
|---|---|---|
| 指向位图的指针 | 通过嵌入位图，可以在单个操作中保存和还原胶囊。 | 0 |
| 不包含视频模式 | 包含视频模式 | 完成此操作的目的是避免在 UpdateCapsule 调用过程中要求固件查询视频模式。 |
| 包含状态字段 | 不包含状态字段 | BGRT 的 "状态" 字段描述图像当前是否显示在屏幕上。 这不适用于固件更新显示封装。 |

## <a name="related-topics"></a>相关主题

[UEFI 固件更新的用户体验](user-experience-for-uefi-firmware-updates.md)  
