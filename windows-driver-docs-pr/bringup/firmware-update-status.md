---
title: 固件更新状态
description: 预计将应用所有固件更新，并在后续调用 Windows OS 加载程序时反映 ESRT 中的所有更新结果。
ms.date: 07/21/2020
ms.localizationpriority: medium
ms.openlocfilehash: de95a5bbf7e331b2cfd4c518f3562da604515aaa
ms.sourcegitcommit: 418e6617e2a695c9cb4b37b5b60e264760858acd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/07/2020
ms.locfileid: "96803351"
---
# <a name="firmware-update-status"></a>固件更新状态

此时，应会应用所有固件更新，并在后续调用 Windows OS 加载程序时反映 **ESRT** 中的所有更新结果。 返回到 [ESRT 表定义](esrt-table-definition.md) 中的 ESRT 示例和固件资源更新驱动程序包 INF 中如果固件的第2版已成功 [应用了固件](authoring-an-update-driver-package.md)的版本2，则新的 ESRT 表将反映此情况。 请注意，表中唯一的差别在于，系统固件资源条目的 "固件版本" 和 "上次尝试版本" 字段已更改，以反映已成功应用的新固件版本。

| 字段 | 值 | 注释 |
|--|--|--|
| 固件资源计数 | 2 | 此表包含两个固件资源条目。 |
| 固件资源最大值 | 2 | 此表分配包含足够的空间，最多可描述两个资源。 |
| 固件资源版本 | 1 | 此表使用的固件资源条目格式版本为1。 |
| 固件资源条目数组 | 固件资源条目0 |  |
| 固件类 |  (系统 \_ 固件)  | 此 GUID 标识用于通过 PnP 进行更新的系统固件。 |
| 固件类型 | 1 | 系统固件类型为1。 |
| 固件版本 | 2 | 当前系统固件版本为2。 |
| 支持的最低固件版本 | 2 | 将支持的最低固件版本更改为2，使固件无法回滚到版本2之前的版本。 固件更新包含安全修补程序时，此值通常会发生更改。 |
| 胶囊标志 | 0 | 系统固件未定义任何专用胶囊更新标志。 |
| 上次尝试版本 | 2 | 尝试更新的最后一个系统固件版本为2 |
| 上次尝试状态 | 0 | 上次系统固件更新尝试成功。 |
|  | 固件资源条目1 |  |
| 固件类 |  (设备 \_ 固件)  | 此 GUID 标识通过 PnP 进行更新的设备固件。 |
| 固件类型 | 2 | 设备固件类型为2。 |
| 固件版本 | 1 | 当前设备固件版本为1。 |
| 支持的最低固件版本 | 1 | 将支持的最低固件版本保持为1。 如果需要，可以将固件回滚到版本1。 |
| 胶囊标志 | 0x8010 | 设备固件定义专用胶囊更新标志 (0x8010) 。 |
| 上次尝试版本 | 1 | 尝试更新的最后一个设备固件版本为1。 |
| 上次尝试状态 | 0 | 上次设备固件更新尝试成功。 |

如果无法成功应用固件，则 **ESRT** 中的 "固件版本"、"上次尝试版本" 和 "上次尝试状态" 条目将反映失败的更新尝试。 例如，如果系统尝试将版本1的固件更新为版本2，但未能成功应用，则固件版本 = 1，上次尝试版本 = 2，最后尝试状态！ = 0。  (即，最后一次尝试状态设置为相应的非零错误代码，指示发生失败的原因。 有关此项的有效错误代码列表，请参阅 [ESRT 表定义](esrt-table-definition.md)。

尽管标准更新策略强制固件版本只能增加，但可通过策略设置来禁用此策略，如下面的 [回滚固件更新](#rolling-back-firmware-updates) 部分所述。

## <a name="system-reset"></a>系统重置

系统重置允许最终用户将其系统恢复回出厂设置。 它通过在制造过程中将预加载的 Windows 映像重新安装到系统来实现此操作。 将重新安装整个操作系统，包括驱动程序和应用程序。

> [!NOTE]
> 由于安全要求阻止了跨安全边界的 **固件回滚** ，因此系统重置无法回滚固件版本以匹配工厂中部署的原始固件。 这意味着所有版本的固件必须与该平台上随附的所有驱动程序和操作系统版本向后兼容。 如果固件不兼容，则可能导致用户将其系统返回给制造商。

## <a name="rolling-back-firmware-updates"></a>回滚固件更新

在某些情况下，可能需要在更新测试过程中回滚固件更新。 每个 ESRT 报告的固件资源在以下注册表项中都有条目： **HKLM\SYSTEM\CurrentControlSet\Control\FirmwareResources**。

该项是一个名称等于用于在 **ESRT** 中报告资源的 GUID 的键。 若要允许固件回滚，请创建一个名为 **Policy** **REG_DWORD** 值，并将该值设置为 **1**。 给定固件资源只能回滚到其支持的最低固件版本，如 **ESRT** 中所指定。 这是为了防止固件回滚到对固件进行关键安全修补的点。 如果要回滚的固件版本满足这些条件，操作系统加载程序将更新到较旧的版本。

## <a name="related-topics"></a>相关主题

[ESRT 表定义](esrt-table-definition.md)  

[即插即用设备](plug-and-play-device.md)  

[创作更新驱动程序包](authoring-an-update-driver-package.md)  

[处理更新](processing-updates.md)  

[来自 UEFI 环境的设备 I/O](device-i-o-from-the-uefi-environment.md)  

[无缝危机预防和恢复](seamless-crisis-prevention-and-recovery.md)  
