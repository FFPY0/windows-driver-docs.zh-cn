---
title: 避免调试器搜索不需要的符号
description: 为什么符号加载有时会花费很长时间？ 这取决于符号名称是限定名称还是未限定名称。
ms.date: 11/28/2017
ms.localizationpriority: medium
ms.openlocfilehash: 2a9f5a4614ef2d9ca30974cd73b39e1bd435eea7
ms.sourcegitcommit: 418e6617e2a695c9cb4b37b5b60e264760858acd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/07/2020
ms.locfileid: "96799823"
---
# <a name="avoiding-debugger-searches-for-un-needed-symbols"></a>避免调试器搜索不需要的符号

**上次更新时间：**

- 5月27日，2007

调试驱动程序时，您会收到一个有趣的断点，只是为了让调试器在很长一段时间内暂停，同时尝试为您不拥有的驱动程序加载符号，并使调试任务不会有任何影响。 这是怎么回事？

默认情况下，调试器会在需要时加载符号。  (这种方法称为延迟符号加载或延迟符号加载。 ) 调试器在执行用于显示符号显示的命令时查找符号。 如果在当前上下文中设置了无效的监视变量（如当前堆栈帧中不存在的函数参数或局部变量），则在断点处可能会发生这种情况，因为在上下文更改时，这些变量将变为无效。 如果你简单地错误地输入符号名称或执行无效的调试器命令，则会发生这种情况，即调试器会开始查找匹配的符号。

为什么这有时会花费很长时间？ 这取决于符号名称是限定名称还是未限定名称。 限定符号名称前面带有符号所在模块的名称，例如，myModule！ myVar。 非限定符号名称未指定模块名称，例如，myOtherVar。

在限定名称的情况下，调试器会在指定的模块中查找符号，如果尚未加载该模块，则会加载模块 (假设该模块存在并且包含符号) 。 这种情况的发生速度非常快。

在未限定名称的情况下，调试器不会 "知道" 哪个模块包含符号，因此必须查看其中的所有模块。 调试器首先检查所有加载的模块中是否存在符号，然后，如果它不能与任何已加载的模块中的符号匹配，则调试器会通过加载所有已卸载的模块（从下游存储开始并以符号服务器结尾）来继续执行搜索。 很明显，这可能需要很长时间。

## <a name="how-to-prevent-automatic-loading-for-unqualified-symbols"></a>如何阻止非限定符号的自动加载

**SYMOPT " \_ 无 \_ 非限定 \_ 加载**" 选项在搜索非限定符号时禁用或启用调试器自动加载模块。 当 **SYMOPT \_ 未设置 \_ 非限定的 \_ 负载** 并且调试器尝试匹配非限定符号时，它将只搜索已加载的模块，并且在它无法匹配符号时停止搜索，而不是加载已卸载的模块来继续执行搜索。 此选项不会影响限定名称的搜索。

**SYMOPT \_默认情况下没有 \_ 非限定的 \_ 负载** 。 若要激活此选项，请使用 **-snul** 命令行选项，或在调试器正在运行时，使用 **. symopt + 0x100** 或 **symopt-0x100** 分别打开或关闭该选项。

若要查看 **SYMOPT \_ 没有未 \_ 限定的 \_ 加载** 的效果，请尝试执行以下试验：

1. 使用 **-n** 命令行选项 (**SYMOPT \_ 调试**) 中激活干扰符号加载，如果调试器已在运行，则使用 **SYMOPT + 0x80000000** 或 **！符号干扰** 调试器扩展命令。 **SYMOPT \_调试** 指示调试器显示其搜索符号的相关信息，例如每个模块加载时的名称，或者调试器找不到文件时的错误消息。
2. 指示调试器计算不存在的符号 (例如，键入 **？ asdasdasd**) 。 调试器在搜索不存在的符号时应报告许多错误。
3. 使用 **SYMOPT + 0x100** 激活 **SYMOPT \_ 未 \_ 限定的 \_ 负载**。
4. 重复步骤2。 调试器应该只搜索已加载的不存在符号的模块，并且应更快地完成任务。
5. 若要禁用 **SYMOPT \_ 调试**，请使用 **SYMOPT-0x80000000** 或 **！符号 quiet** 调试器 extension 命令。

有许多选项可用于控制调试器加载和使用符号的方式。 有关符号选项的完整列表以及如何使用它们，请参阅随 Windows 调试工具提供的联机文档中的 "设置符号选项"。 最新版本的适用于 Windows 的调试工具包可从 web 免费下载，也可以从 Windows DDK、平台 SDK 或客户支持诊断 CD 安装包。

## <a name="what-should-you-do"></a>你应该如何操作？

- 若要加快符号搜索速度，请尽可能在断点和调试器命令中使用限定名。 如果要查看已知模块的符号，请将其限定为模块名称;如果不知道符号的位置，请使用非限定名称。 对于局部变量和函数参数，请使用 **$** 作为模块名称 (例如， *$！MyVar*) 。
- 若要诊断出现慢符号加载的原因，请使用 **-n** 命令行选项 (**SYMOPT \_ 调试**) 中激活干扰符号加载，或者，如果调试器已在运行，则使用 **. SYMOPT + 0x80000000** 或 **！符号干扰** 调试器扩展命令。
- 若要阻止调试器在已卸载的模块中搜索符号，请使用 **-snul** 命令行选项或（如果已在运行该调试器，则使用 **SYMOPT + 0X100**）激活 **\_ \_ \_ SYMOPT** 。
- 若要显式加载调试会话所需的模块，请使用的调试器命令（如） **。** **ld**

## <a name="related-topics"></a>相关主题

[下载 WDK](../download-the-wdk.md)

[下载 Windows 调试工具](debugger-download-tools.md)

[Windows 调试入门](getting-started-with-windows-debugging.md)
