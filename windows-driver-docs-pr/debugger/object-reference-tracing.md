---
title: 对象引用跟踪
description: 对象引用跟踪
keywords:
- 对象引用跟踪
- 对象引用跟踪，概述
- GFlags，对象引用跟踪
ms.date: 05/23/2017
ms.localizationpriority: medium
ms.openlocfilehash: 7f2061e5f038cab951e02597ee6d9fbac512a083
ms.sourcegitcommit: 418e6617e2a695c9cb4b37b5b60e264760858acd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/07/2020
ms.locfileid: "96833633"
---
# <a name="object-reference-tracing"></a>对象引用跟踪


**对象引用跟踪** 功能记录每次对象引用计数器递增或递减时的顺序堆栈跟踪。 跟踪有助于检测对象引用错误，包括双重取消引用、引用失败和取消引用对象。 只有 Windows Vista 和更高版本的 Windows 支持此功能。

有关在 " **全局标志** " 对话框中配置对象引用跟踪功能的信息，请参阅 [配置对象引用跟踪](configuring-object-reference-tracing.md)。 有关在命令提示符处配置对象引用跟踪功能的信息，请参阅 [**GFlags 命令**](gflags-commands.md)。 有关示例，请参阅 [示例15：使用对象引用跟踪](example-15--using-object-reference-tracing.md)。

当您怀疑某个特定对象未被正确引用或取消引用时，对象引用跟踪最为有用，这通常是因为增加的池使用率表明某个对象正在泄漏，或者进程或会话无法结束（即使其句柄计数为零）。 不同于日志中记录的跟踪以供以后查看，对象引用跟踪旨在实时使用，而进程正在运行并且引用和取消引用对象。 使用 [**！ obtrace 调试器扩展**](-obtrace.md)在调试器中查看对象引用跟踪。 由于此扩展需要指定的对象地址，因此你必须事先知道哪个对象是错误的可能源。

以下规则适用于对象引用跟踪：

-   一次只能运行一个对象引用跟踪。

-   因为内核范围的跟踪是不可行的，所以必须将跟踪限制为使用指定的池标记创建的对象，或限制为指定进程创建的对象 () 的图像文件名或同时指定）。

-   对于每个跟踪，只能指定一个映像文件。 如果指定一个图像文件，则该跟踪限制为由该图像表示的进程创建的对象。 进程引用但由其他进程创建的对象不进行跟踪。

-   最多可为每个跟踪指定16个池标记。 跟踪具有任何指定的池标记的对象。

-   如果同时指定了图像文件和一个或多个池标记，则跟踪限制为进程创建的对象，并且具有指定的任何池标记。

-   对象引用跟踪无法跟踪启动跟踪时已在运行的进程。 跟踪仅包括在跟踪开始后启动的进程的对象。

-   跟踪标记为跟踪的对象，直到对象被销毁或禁用跟踪。 默认情况下，仅在销毁对象之前维持对象的跟踪，但你可以指定 "永久" 跟踪 (**/p**) ，此时将在禁用跟踪之前保留跟踪。

-   可以将对象引用跟踪配置存储为注册表设置，也可以将内核标志存储 (运行时) 设置。 如果你同时具有注册表和内核标志设置，则运行时设置优先，但当你关闭或重新启动计算机时，这些设置将丢失。

 

 





