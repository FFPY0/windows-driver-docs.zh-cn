---
title: 枚举 GPU 引擎功能
description: 从 Windows 8.1 开始，显示微型端口驱动程序必须实现 DxgkDdiGetNodeMetadata 函数，该函数用于查询 GPU 节点的引擎功能。
keywords:
- GPU 节点，枚举 WDK 显示驱动程序
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: b62d4a277bea3713b2b13c94e1f5dffb565b65fc
ms.sourcegitcommit: 418e6617e2a695c9cb4b37b5b60e264760858acd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/07/2020
ms.locfileid: "96786889"
---
# <a name="enumerating-gpu-engine-capabilities"></a>枚举 GPU 引擎功能


从 Windows 8.1 开始，显示微型端口驱动程序必须实现 [*DxgkDdiGetNodeMetadata*](/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_getnodemetadata) 函数，该函数用于查询 GPU 节点的引擎功能。

此信息有助于评估如何在节点之间计划和分配工作负荷，并改善调试应用程序的能力。

## <a name="span-idengine_capabilities_device_driver_interface__ddi_spanspan-idengine_capabilities_device_driver_interface__ddi_spanspan-idengine_capabilities_device_driver_interface__ddi_spanengine-capabilities-device-driver-interface-ddi"></a><span id="Engine_capabilities_device_driver_interface__DDI_"></span><span id="engine_capabilities_device_driver_interface__ddi_"></span><span id="ENGINE_CAPABILITIES_DEVICE_DRIVER_INTERFACE__DDI_"></span>引擎功能设备驱动程序接口 (DDI) 


此接口提供指定 GPU 节点的引擎功能：

-   [*DxgkDdiGetNodeMetadata*](/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_getnodemetadata)
-   [**DXGKARG \_ GETNODEMETADATA**](./index.md)
-   [**DXGK \_ 引擎 \_ 类型**](/windows-hardware/drivers/ddi/d3dkmdt/ne-d3dkmdt-dxgk_engine_type)

指向 [*DxgkDdiGetNodeMetadata*](/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_getnodemetadata)函数的指针由 [**驱动程序 \_ 初始化 \_ 数据**](/windows-hardware/drivers/ddi/dispmprt/ns-dispmprt-_driver_initialization_data)结构的 **DxgkDdiGetNodeMetadata** 成员提供。

## <a name="span-idgpu_node_architecturespanspan-idgpu_node_architecturespanspan-idgpu_node_architecturespangpu-node-architecture"></a><span id="GPU_node_architecture"></span><span id="gpu_node_architecture"></span><span id="GPU_NODE_ARCHITECTURE"></span>GPU 节点体系结构


系统上的每个显示适配器都有多个可用于计划任务的引擎。 每个引擎仅分配给一个节点，但如果该节点与多个适配器相关联，则每个节点可能包含多个引擎，例如在链接的显示适配器 (LDA) 配置中，多个物理 Gpu 都链接在一起形成一个速度更快的虚拟 GPU。

![gpu 引擎和节点的体系结构](images/gpu-engine-node-architecture.png)

不同的节点代表 GPU 的非对称处理核心，而每个节点中的引擎代表适配器上的对称处理核心。 也就是说，一个三维节点在多个适配器上只包含相同的3-d 引擎，而不是其他引擎类型。

由于引擎始终按引擎类型在节点中组合在一起，因此可以根据指定的节点查询引擎类型信息。 [**DXGK \_ 引擎 \_ 类型**](/windows-hardware/drivers/ddi/d3dkmdt/ne-d3dkmdt-dxgk_engine_type)枚举中列出了显示微型端口驱动程序可以指定的引擎类型。

## <a name="span-idexample_implementation_of_node_metadata_functionspanspan-idexample_implementation_of_node_metadata_functionspanspan-idexample_implementation_of_node_metadata_functionspanexample-implementation-of-node-metadata-function"></a><span id="Example_implementation_of_node_metadata_function"></span><span id="example_implementation_of_node_metadata_function"></span><span id="EXAMPLE_IMPLEMENTATION_OF_NODE_METADATA_FUNCTION"></span>节点元数据函数的示例实现


此代码显示了显示微型端口驱动程序如何实现可由 [*DxgkDdiGetNodeMetadata*](/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_getnodemetadata) 函数返回的某些引擎类型。

```ManagedCPlusPlus
NTSTATUS
IHVGetNodeDescription(
        IN_CONST_HANDLE                     hAdapter,
        UINT                                NodeOrdinal,
        OUT_PDXGKARG_GETNODEMETADATA        pGetNodeMetadata
        )
{
    DDI_FUNCTION();
    PAGED_CODE();

    if(NULL == pGetNodeMetadata)
    {
        return STATUS_INVALID_PARAMETER;
    }

    CAdapter *pAdapter = GetAdapterFromHandle(hAdapter);

    //Invalid handle
    if(NULL == pAdapter)
    {
        return STATUS_INVALID_PARAMETER;
    }

    //Node ordinal is out of bounds. Required to return
    //STATUS_INVALID_PARAMETER
    if(NodeOrdinal >= pAdapter->GetNumNodes())
    {
        return STATUS_INVALID_PARAMETER;
    }

    switch(pAdapter->GetEngineType(NodeOrdinal))
    {
        //This is the adapter's 3-D engine. This engine handles a large number
        //of different workloads, but it also handles the adapter's 3-D 
        //workloads. Therefore the 3-D capability is what must be exposed.
        case GPU_ENGINE_3D:
        {
            pGetNodeMetadata->EngineType = DXGK_ENGINE_TYPE_3D;
            break;
        }

        //This is the adapter's video decoding engine
        case GPU_ENGINE_VIDEO_DECODE:
        {
            pGetNodeMetadata->EngineType = DXGK_ENGINE_TYPE_VIDEO_DECODE;
            break;
        }

        //This engine is proprietary and contains no functionality that
        //fits the DXGK_ENGINE_TYPE enumeration
        case GPU_ENGINE_PROPRIETARY_ENGINE_1:
        {
            pGetNodeMetadata->EngineType = DXGK_ENGINE_TYPE_OTHER;

            //Copy over friendly name associated with this engine
            SetFriendlyNameForEngine(pGetNodeMetadata->FriendlyName,
                                     DXGK_MAX_METADATA_NAME_LENGTH,
                                     PROPRIETARY_ENGINE_1_NAME);
            break;
        }
    }

    return STATUS_SUCCESS;
}
```

 

