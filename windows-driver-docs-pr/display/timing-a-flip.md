---
title: 交替计时
description: 交替计时
keywords:
- 绘图页反向 WDK DirectDraw，计时
- DirectDraw 翻转 WDK Windows 2000 显示、计时
- 页面翻转 WDK DirectDraw，计时
- 翻转 WDK DirectDraw，计时
- 计时反向 WDK DirectDraw
- 显示持续时间 WDK DirectDraw
- 泪水 WDK DirectDraw
- 扫描行 WDK DirectDraw
- surface DirectDraw，翻转
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: ea20c5e66129d33356d2c02a8fb9d8873481cba7
ms.sourcegitcommit: 418e6617e2a695c9cb4b37b5b60e264760858acd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/07/2020
ms.locfileid: "96820779"
---
# <a name="timing-a-flip"></a>交替计时


## <span id="ddk_timing_a_flip_gg"></span><span id="DDK_TIMING_A_FLIP_GG"></span>


如果反向寄存器可用且扫描行已知，则可以使用翻转计时。 只需检查反向寄存器即可查看是否发生了最后一次翻转，然后在执行翻转之前确保扫描行不处于垂直空白。 但是，如果扫描行和反向注册不可用，则使用以下段落中描述的一个或多个算法。

-   如果硬件没有用于检查扫描线是否经过刷新周期的一点，则应使用多个方法来进行翻转。 替代方法基于经过的时间。 如果自上次翻转后，绘制整个图面所用的时间充足，可以进行翻转。 此时间量决定了凭经验 (，除非监视器刷新率已知) 在驱动程序初始化时，并且通过轮询在模式发生变化时进行轮询，直到显示处于垂直同步状态，然后轮询直到它不处于垂直同步状态。这适用于20次迭代，线程执行优先级设置为 "最大"。 结果除以20以 *显示持续时间*。 这是允许访问后台缓冲区之前需要等待的最长时间。  (如果显示持续时间已已知，则不需要计算。 ) 在大多数情况下，执行翻转之前需要更短的时间段，但会将显示持续时间用作回退，因为它完全可靠。

-   如果只有扫描行的行号可用，最快的方法是记录时间和扫描行。 然后，当扫描行小于之前，它已经历刷新周期。 例如，如果扫描行第一次被50轮询时位于第300行第行，则在下一次显示时，整个表面显示至少一次。 但是，扫描行在所有显示卡上没有完全可靠。 在某些情况下，可以同时读取和写入寄存器，提供两个不同数字的一半。 在这些情况下，必须读取注册两次，以验证它是否报告了正确的数字。 在某些情况下，扫描行在通过水平同步时可能会不准确。一个标志，用于指示扫描行当前是否处于显示中通常会在扫描行处于水平空白时返回假负结果。

-   如果扫描行的行号不可用，则可能会验证扫描行是否已通过垂直空白显示，并返回显示。 通过在扫描行传入和传出时进行跟踪，你可以确定完成整个刷新周期的时间。 在所有显示卡上检查扫描行的显示或垂直空白功能是否可用，但扫描行号不能为。

可能需要进行少量调整，才能获取显示的最后一小部分，例如，确保在读取地址之后没有进行任何计算 (例如，将两个位置向右移位以获得真正的地址，因为地址位于 DWORD 边界) 上。 若要避免撕裂，请确保扫描行不为垂直空白，刚好在垂直同步上方，并在写入到反向寄存器之前显示。

尽管显示卡基于原始 IBM 视频图形卡 (VGA) 规范，但 Super VGAs 有很大差别 (参阅 *EGA、VGA 和超级 VGA 卡的程序员指南* ，Richard Ferraro-Addison-Wesley，最新版本) 。 某些卡不提供直接的方法来确定扫描行是否为垂直空白，或者是否在显示时也是如此。 这些缺陷更重要，因为在竞争中满足了高级显示功能的需求。 同时，驱动程序编写者必须使用创造性来弥补这些缺陷。

可以进行翻转后，就会在反向寄存器中加载对要显示的下一个图面的引用。 在扫描行越过垂直同步并返回到显示区域之前，不会发生任何操作。 然后，反向注册将被读取一次。 如果在该时间之前反向注册中存储了其他内容，或者如果该图面在被读取时被写入，则会出现一条撕。 读取注册后，不应将其锁定或写入，因为它仍在被绘制。

检查寄存器是否已读只是在大多数较新卡片中检查标志。 然而，在较旧的卡片中，通常会使用硬件中断来实现此目的。 当在反向寄存器中越过了某个点时，将调用与该中断挂钩的任何函数。 问题在于，在某些较新的硬件中，此中断可用于其他目的。

 

 





