---
title: 示例 I/O 请求 - 概述
description: 示例 I/O 请求 - 概述
keywords:
- 打开文件对象
- 命名文件对象 WDK 内核
- 文件对象 WDK 内核
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 2690a7b15b9805b08140ad33eae6fd804da54c09
ms.sourcegitcommit: 418e6617e2a695c9cb4b37b5b60e264760858acd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/07/2020
ms.locfileid: "96785127"
---
# <a name="example-io-request---an-overview"></a>示例 I/O 请求 - 概述





下图显示了代表应用程序打开代表数据文件的文件对象时，会发生什么情况的概述。

![演示如何打开文件对象的关系图](images/2opendev.png)

1.  子系统调用 i/o 系统服务来打开命名文件。

2.  I/o 管理器调用对象管理器来查找命名文件，并帮助它解析文件对象的任何符号链接。 它还调用安全引用监视器来检查子系统是否具有打开该文件对象的正确的访问权限。

3.  如果尚未装入卷，则 i/o 管理器会暂时挂起打开请求，并调用一个或多个文件系统，直到其中一个文件系统将文件对象识别为其存储在文件系统所使用的一种大容量存储设备上。 当文件系统已装载卷时，i/o 管理器将恢复请求。

4.  I/o 管理器为分配内存，并为打开的请求初始化 IRP。 对于驱动程序，open 等效于 "create" 请求。

5.  I/o 管理器会调用文件系统驱动程序，并向其传递 IRP。 文件系统驱动程序将访问 IRP 中的 i/o 堆栈位置，以确定它必须执行的操作，检查参数，确定请求的文件是否在缓存中，如果不是，则在 IRP 中设置下一个较低的驱动程序的 i/o 堆栈位置。

6.  这两个驱动程序都处理 IRP 并完成请求的 i/o 操作、调用由 i/o 管理器和其他系统组件提供的内核模式支持例程，而不会在上图) 中显示 (。

7.  驱动程序将 IRP 返回到设置了 IRP 中的 i/o 状态块的 i/o 管理器，以指示请求的操作是成功还是失败。

8.  I/o 管理器从 IRP 获取 i/o 状态，因此它可以通过受保护的子系统将状态信息返回到原始调用方。

9.  I/o 管理器释放已完成的 IRP。

10. 如果打开操作成功，i/o 管理器会为该文件对象返回一个句柄。 如果发生错误，它会将相应状态返回到子系统。

在子系统成功打开一个表示数据文件、设备或卷的文件对象后，子系统将使用返回的句柄来识别后续的设备 i/o 操作请求中的文件对象， (通常是读取、写入或设备 i/o 控制请求) 。 为了发出此类请求，子系统将调用 i/o 系统服务。 I/o 管理器将这些请求作为 Irp 发送到相应的驱动程序。

 

 




