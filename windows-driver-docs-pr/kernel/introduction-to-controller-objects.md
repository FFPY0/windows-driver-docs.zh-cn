---
title: 控制器对象简介
description: 控制器对象简介
keywords:
- 控制器对象 WDK 内核，关于控制器对象
- ControllerControl 例程，关于 ControllerControl 例程
- 重叠 i/o WDK 内核
- I/o WDK 内核，重叠
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 5bdbd74656086b9cd54c2fe29365836c97a8bda3
ms.sourcegitcommit: 418e6617e2a695c9cb4b37b5b60e264760858acd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/07/2020
ms.locfileid: "96832289"
---
# <a name="introduction-to-controller-objects"></a>控制器对象简介





顾名思义，控制器对象通常表示包含附加设备的物理设备控制器。 由物理控制器协调的一组相似设备的最低级别非 WDM 驱动程序可以创建控制器对象，并使用它来同步连接的设备之间的 i/o 操作。 该驱动程序实现 [*ControllerControl*](https://msdn.microsoft.com/library/windows/hardware/ff542049) 例程并调用 i/o 管理器的控制器对象支持例程。

**注意**   WDM 驱动程序不支持使用控制器对象。

 

通常，如果以下条件成立，驱动程序将使用控制器对象将操作同步到连接的设备：

-   控制器不会执行长时间的操作而不会中断，因此驱动程序无需创建设备专用线程或使用系统工作线程。

-   连接到控制器的设备类似。 也就是说，它们不是具有完全不同的物理属性或操作功能的设备，如可以连接到键盘和辅助设备控制器的键盘和鼠标设备。

-   驱动程序设计为单一层次：与设备控制器和连接的物理设备相关，而不是设计为控制器) 的端口驱动程序 ( (用于连接设备的一个或多个类驱动程序，) 通过端口驱动程序进行分层。

具有 i/o 通道和一组逻辑设备对象的设备的驱动程序还可以使用控制器对象来同步其在此类设备的通道之间或其之间的 i/o 操作。

控制器对象没有名称，因此不是 i/o 请求的目标。 它只是一种用于序列化一组设备对象中的 i/o 的同步机制。 由于控制器对象没有名称，因此不能在用户模式受保护的子系统上使用，而不会获得表示目标设备对象的文件对象的句柄。 控制器对象对于较高级别的驱动程序也不可见，因此不能将其自己的设备对象附加到控制器对象。 换句话说，i/o 管理器和更高级别的驱动程序都不能在控制器对象表示的设备上设置 IRP 请求 i/o。 I/o 请求始终颁发给设备对象。 只有驱动程序可以使用控制器对象。

### <a name="synchronization-and-overlapped-io"></a>同步和重叠 i/o

物理设备的单一驱动程序（其功能类似于 "AT" 磁盘控制器）不需要使用控制器对象来同步其设备 i/o 操作。 例如，驱动程序编写器可以尝试如下同步技术，而不是使用控制器对象：

-   设置命名设备对象，以表示 i/o 请求的目标设备。

-   维护状态信息 (可能是每个设备扩展或单个设备扩展中的一组设备忙标志，) 指示哪个设备对象是当前 i/o 操作的目标。

-   执行当前繁忙设备对象的 i/o 操作，并为其他设备对象重新排队传入的 Irp，直到当前 IRP 完成。

以上同步技术为驱动程序的所有目标设备对象序列化 IRP 处理。 请注意，它还强制驱动程序在 [*StartIo*](/windows-hardware/drivers/ddi/wdm/nc-wdm-driver_startio) 例程开始处理下一个 irp 之前完成当前 irp，这会降低驱动程序性能。

如果某些设备操作可以重叠，则使用控制器对象可能会增加驱动程序的 i/o 吞吐量，因为此同步技术允许驱动程序在设置物理设备之前确定是否可以重叠操作。 例如，磁盘控制器可能允许驱动程序在一个磁盘上使用另一个磁盘上的读/写操作来重叠查找。

而且，使用控制器对象是一种相对简单的方法，它通过单个物理设备（如 "AT" 磁盘控制器）为多个目标设备对象同步 i/o 操作。 使用控制器对象允许单一驱动程序在一组命名的设备对象之间同步 i/o 操作，而无需在一个或多个设备扩展中维护每个设备和设备控制器的状态，并且无需重新排队 Irp。

但是，某些设计为与 i/o 操作（如全双工串行控制器或总线主适配器）进行重叠的设备通常具有为 Irp 设置内部队列的驱动程序。

 

