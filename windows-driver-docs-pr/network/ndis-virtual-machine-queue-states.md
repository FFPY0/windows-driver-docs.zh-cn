---
title: NDIS 虚拟机队列状态
description: NDIS 虚拟机队列状态
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: b1f74e9ba7c8474b6b33397c510126e1a3e3a545
ms.sourcegitcommit: 418e6617e2a695c9cb4b37b5b60e264760858acd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/07/2020
ms.locfileid: "96789693"
---
# <a name="ndis-virtual-machine-queue-states"></a>NDIS 虚拟机队列状态





本主题概述了 NDIS 虚拟机队列 (Vmq) 的操作状态。 有关队列状态的详细信息，请参阅[编写 VMQ 驱动程序](writing-vmq-drivers.md)部分中的[队列状态和操作](queue-states-and-operations.md)主题。

对于每个队列，网络适配器必须支持以下操作状态集：

-   Undefined

-   已分配

-   设置

-   已暂停

-   正在运行

-   停止 DMA

-   减轻

下图显示了这些状态之间的关系。

![说明 ndis vm 队列状态和事件的示意图](images/queuestate.png)

下面定义了适配器状态：

<a href="" id="undefined"></a>尚未  
*未定义* 的是队列的初始状态。 在此状态下，不分配队列。 队列 (除了始终存在的默认队列) 未定义，直到微型端口驱动程序接收到队列分配请求。 此外，在完成免费操作并完成已启动的任何接收指示后，它是不确定的。

<a href="" id="allocated"></a>已分配  
队列在分配请求之后和在队列上设置任何筛选器之前处于已 *分配* 状态。 如果队列处于设置状态，并且在队列中清除了最后一个筛选器，则筛选器还可以输入分配的状态。 如果微型端口驱动程序收到分配完成请求，而微型端口驱动程序处于已分配状态，则队列进入暂停状态。 如果微型端口驱动程序收到一个免费队列请求，则队列将进入停止 DMA 状态。

<a href="" id="set"></a>设置  
在 *设置* 状态下，分配队列，并在队列中设置至少一个筛选器，但微型端口驱动程序尚未接收到分配完成 OID。 如果队列收到分配完成请求，则进入正在运行状态。 如果清除了队列上的最后一个筛选器，则队列进入已分配状态。 请注意，当队列中有设置筛选器时，不能释放队列。

<a href="" id="paused"></a>悬停  
处于 *暂停* 状态时，队列将被分配，但其微型端口驱动程序不会指示收到的数据包，因为没有在队列中设置筛选器。 微型端口驱动程序可以从已分配状态或从运行状态进入暂停状态。 队列在收到筛选器设置请求时进入 "正在运行" 状态。 队列在收到免费队列请求时进入停止 DMA 状态。

<a href="" id="running"></a>正在运行  
在 " *正在运行* " 状态下，队列设置了筛选器，队列分配已完成，网络适配器指示接收数据包。 如果清除了队列上的最后一个筛选器，则队列将进入暂停状态。 请注意，当队列中有设置筛选器时，不能释放队列。 此外，如果清除了最后一个筛选器，则微型端口驱动程序可以停止 DMA。 但是，在这种情况下，微型端口驱动程序不应发送 DMA 停止状态指示。

<a href="" id="stop-dma"></a>停止 DMA  
在 *停止 DMA* 状态下，微型端口驱动程序收到了一个免费队列请求，必须停止 dma 活动。 微型端口驱动程序必须发送 DMA 停止状态指示。 当微型端口驱动程序发送状态指示后，队列将处于释放状态。 请注意，清除最后一个筛选器后，可能已停止 DMA。 但是，微型端口驱动程序只应在收到免费队列请求时发送状态指示。

<a href="" id="freeing"></a>减轻  
在 "正在 *释放* " 状态下，微型端口驱动程序正在等待队列中所有未完成的接收指示完成，并释放与该队列关联的资源。 释放所有资源后，队列将进入未定义状态。

 

 





