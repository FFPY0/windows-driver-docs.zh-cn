---
title: 通信模型、同步和中止
description: 本部分介绍 WDI 通信模型、同步和中止
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: b148ad93bf84d76ac9486aac44e569d64adb17c1
ms.sourcegitcommit: 418e6617e2a695c9cb4b37b5b60e264760858acd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/07/2020
ms.locfileid: "96790405"
---
# <a name="communication-model-synchronization-and-abort"></a>通信模型、同步和中止


在高级别上，本文档定义了两种类型的对象：

1.  适配器，表示 Wi-Fi 设备。
2.  端口，表示适配器中的不同 MAC 和 PHY 实体。

有关这些对象的详细信息，请参阅 [wi-fi 设备型号和对象](wdi-objects.md)。
为每个对象定义了一组允许的操作。 命令进一步分类到属性和任务中。

属性命令是简单的命令 (如获取信号强度、获取当前 BSS 列表和设置数据包筛选器) 。 它们会在短时间内完成，实现起来并不复杂。

任务命令是复杂的操作，可能需要几秒钟才能完成。 例如，Wi-Fi 扫描操作将分类为此模型中的任务。

颁发给 IHV 组件的所有命令都可以异步完成。

## <a name="sequence-of-messages"></a>消息序列


下图显示了每种类型的命令的消息序列。

图1显示了任务命令序列。

![wdi 命令任务流](images/wdi-command-task-flow.png)

图2显示了属性命令流。

![wdi 属性命令流](images/wdi-property-command-flow.png)

图3显示了指示的流。

![wdi 指示流](images/wdi-indication-flow.png)

## <a name="synchronization"></a>同步


为了使 IHV 组件实现简单，该模型定义了下列同步规则：

1.  命令始终在图1和图2中的步骤1和3之间序列化。 例如，在步骤3中的适配器指示之前，不会向适配器发出任何新命令。 这也意味着所有属性都相互序列化。
2.  所有任务命令在图1中的步骤1和4之间序列化。 例如，一次只能在适配器上运行一个任务。 但是，启动任务后 (图 1) 中的步骤3，适配器可能会获得属性命令请求。 步骤3和步骤4都必须在下一任务命令发送前完成。
3.  属性集命令分为两种类型：在任务启动后可以发送的命令，以及必须通过挂起任务进行序列化的类型。
4.  除了文档稍后介绍的特定情况以外，数据路径不会与命令路径一起序列化。
5.  同步范围为 "适配器级别范围"。
6.  任务子集可以在启动后中止。 这意味着，如果较高优先级任务 () ，而 (B) 未完成，则主机可以中止 B。 确定优先级决策的合理化超出了本文档的范围，并依赖于用户方案。
7.  对于任务命令，步骤4可以在步骤3完成之前进行。 但是，如果指示了步骤4，则步骤3不会失败。

## <a name="abort"></a>中止


大多数任务在启动后可能会中止。 中止的目的是通过在图 1) 中的步骤 4 (发送完整的指示来触发适配器以快速完成任务。 仅允许在图1中的步骤3和4之间的窗口中中止。 接收到中止后，适配器必须在50毫秒内完成该任务。 对于大多数命令，接收到中止后，适配器无需回滚到启动命令之前的状态。 发出的中止命令与到达主机组件的完成之间存在争用情况。 在这种情况下，如果 IHV 组件收到已完成的任务的中止，则不需要从 IHV 组件进行进一步操作来处理中止操作。 中止任务只是一种指示 IHV 组件应该尽快清除任务的信号。 如果发出了中止，则不会更改命令完成语义。 Abort 属性命令的完成和任务完成指示必须在所有情况下都得到适当的通知。

属性需要很短的时间才能完成，因此无法中止。

任务命令有一个唯一的标识符，该标识符允许主机针对特定的命令进行中止。

 

 





