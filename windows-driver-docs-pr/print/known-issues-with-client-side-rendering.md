---
title: 客户端呈现的已知问题
description: 客户端呈现的已知问题
keywords:
- 客户端呈现 WDK 打印，已知问题
ms.date: 01/24/2019
ms.localizationpriority: medium
ms.openlocfilehash: 097b2eef3c67ca0558b8d182bf089377665ec0e3
ms.sourcegitcommit: 418e6617e2a695c9cb4b37b5b60e264760858acd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/07/2020
ms.locfileid: "96796495"
---
# <a name="known-issues-with-client-side-rendering"></a>客户端呈现的已知问题

默认情况下，为所有驱动程序启用了客户端呈现，因为它对大多数打印机驱动程序是透明的，并为用户提供了明确的好处。 大多数打印机驱动程序在启用此功能时不会遇到任何问题。

但是，如果打印机驱动程序遇到问题，则可以禁用客户端呈现功能，打印机驱动程序会在打印服务器上呈现打印作业，如以前版本的 Windows 操作系统。 系统管理员还可以使用服务器组策略上的 "始终呈现打印作业" 来禁用客户端呈现。

> [!NOTE]
> 如果禁用客户端呈现功能，打印作业呈现会移动到打印服务器，这可能会对打印服务器性能产生负面影响。

驱动程序包中安装的打印机驱动程序在客户端呈现时不会出现问题。

以下列表描述了客户端呈现的一些已知问题：

- 如果打印机驱动程序使用自定义打印处理器但客户端计算机上未安装打印处理器，则会自动禁用客户端呈现。

  在某些情况下，在点和打印期间，不会在客户端计算机上安装打印机驱动程序的打印处理器。 如果打印后台处理程序检测到问题，它将禁用该打印队列的客户端呈现。 若要避免此问题，请创建打印机驱动程序的驱动程序包。

- 如果打印处理器返回错误，则将禁用打印队列的客户端呈现。

  禁用打印队列的客户端呈现后，打印后台处理程序使用服务器端呈现重试打印作业。 请注意，在对打印队列禁用客户端呈现后，打印队列将不再具有任何客户端呈现权益，如脱机打印。

- 对于使用非标准配置数据的打印机驱动程序，打印机配置数据可能不完整。

  "点和打印" 可能无法传输使用专有方法存储和传达此数据的打印机驱动程序的完整打印机配置数据。 可以通过使用 **SetPrinterData** 或 **SetPrinterDataEx** 函数存储打印机配置数据并使用 **GetPrinterData** 或 **GetPrinterDataEx** 函数来重新调用打印机配置数据，从而解决此问题。 有关这些函数的详细信息，请参阅 Microsoft Windows SDK 文档。

- 使用驱动程序不匹配的客户端呈现。

  当客户端计算机与服务器具有不同版本的打印机驱动程序时，存在打印机驱动程序不匹配。 通常，当打印机驱动程序不匹配时，指向和打印将更新客户端计算机上的打印机驱动程序，以便与服务器上的打印机驱动程序匹配。 在某些情况下，你可能希望客户端计算机上的打印队列使用与打印服务器上的打印机驱动程序版本不匹配的打印驱动程序版本。 例如，你可能不希望指向和打印在客户端计算机上更新打印机驱动程序：

  - 如果在客户端计算机上运行时，打印服务器上的打印机驱动程序存在兼容性问题。
  - 若要减少单点和打印下载新打印机驱动程序时产生的网络流量。
  - 调试或测试时。

  你可以阻止 "指向和打印" 下载打印机驱动程序，并强制客户端计算机使用已安装在客户端计算机上的最佳驱动程序。 若要选择此行为，请将 HKLM \\ SYSTEM \\ CurrentControlSet \\ Control \\ Print \\ *PrinterName* \\ PrinterDriverData \\ DriverPolicy 注册表项的值设置为打印机驱动程序的名称。 将 *PrinterName* 替换为打印队列的名称，以使用本地可用的打印机驱动程序，而不是打印服务器中提供的打印机驱动程序。 在此注册表项中输入的驱动程序名称必须是已安装或可在客户端计算机上安装的兼容打印机驱动程序的名称。

  你还可以通过调用 **AddPrinterConnection2**，设置打印机 \_ 连接 \_ 不匹配标志，并在 \_ \_ \_ *pConnectionInfo* 参数引用的打印机连接信息1结构中指定打印机驱动程序的名称，以编程方式创建打印机连接。 Windows SDK 文档中介绍了 **AddPrinterConnection2** 。

- 从 Windows 8 开始，如果注册表中不存在 EMFDespoolingSetting 值并且客户端计算机配置文件是移动平台，则会自动禁用客户端呈现。

  如果客户端是移动平台（如便携式计算机或平板电脑设备），若要启用省电消耗，则当注册表中不存在此值时，后台处理程序会自动禁用客户端呈现。 可以通过调用 SetPrinterData 将打印队列的 EMFDespoolingSetting 值设置为0，在驱动程序中显式启用移动平台的客户端呈现。

  你可以使用 msinfo32.exe 来确认是否已将计算机配置为移动或桌面配置文件：

  ![msinfo32.exe 配置文件的屏幕截图](images/emfdespoolingsetting.png)

如果在测试期间检测到客户端呈现功能可能导致的打印机驱动程序出现问题，则可以禁用驱动程序的客户端呈现。 可以通过调用 **SetPrinterData** 将打印队列的 EMFDespoolingSetting 值设置为1来禁用驱动程序中的客户端呈现。 此值将导致连接到打印队列的所有客户端在服务器上呈现打印作业。
